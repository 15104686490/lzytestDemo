InnoDb存储引擎
后台线程
master thread
核心后台线程 负责将缓冲池中的数据异步刷新到磁盘  保证一致性
内部存在多个循环
主循环 后台循环 刷新循环 暂停循环
iO thread
AIO async io 处理IO请求 io thread负责这些io请求的回调 write read insertbuffer log
purge thread
事务提交后 undolog不在被需要  因此使用 该线程来对已经使用并分配的undo页进行回收
page cleaner thread
负责脏页刷新工作

内存
缓冲池
缓解CPU速度与磁盘速度之间的差别 通过内存速度缓解磁盘速度对性能的影响
数据库页的修改操作  首先修改缓冲池中的页 而后按照一定的频率刷新到磁盘  通过checkpoint 机制刷新回磁盘
缓冲池中的页类型： 索引页  数据页  undo页 插入缓存  自适应哈希索引 锁信息 数据字典信息
缓存管理机制 通常是lru 即使用频繁的在列表的前端  使用较少的页在列表的尾端  空间不足时首先释放列表尾部的页
缓冲池的默认的页大小默认为16kb
innodb中 lru优化  增加midpoint 即最新访问的页放在该处 避免类似扫描操作使数据被刷出 原因是这种操作会访问较多的页 甚至全部的页
而通常这些并不全部都是热点数据
重做日志缓冲
额外内存池
该引擎中对内存的管理通过一种堆内存的方式进行

check point
目的
1.缩短数据库的恢复时间
2.缓冲池空间不足时  将脏页刷新到磁盘
3.重做日志不可用时 刷新脏页
分为两种
sharp checkpoint
发生在数据库关闭时  将所有的脏页都刷新回磁盘
fuzzy checkpoint
只刷新一部分脏页

关键特性
插入缓存
两次写
自适应哈希索引
异步IO
刷新邻接页

insert Buffer
非聚集索引的更新  并不是每次都直接插入到索引页中 而是先判断插入的非聚集索引是否在缓冲池中 在则直接插入  若不在
则先放到insert buffer对象 后续再以一定的频率进行insertBuffer和非聚集索引的合并操作
条件  1. 索引时辅助索引 2.索引不是唯一的

change buffer
对dml操作 insert delete update 进行缓冲
分为个过程
1.标记为已删除 2.真正将记录删除

double write
数据页可靠性
使用重做日志前 需要一个副本页  发生写入失效时  先通过该副本来进行还原 而后在进行重做 即double write
内存中的double write buffer 以及  磁盘中的

自适应哈希索引
观察个索引的查询情况 而后通过建立该索引提升速度  根据访问的频率和模式

异步IO
使用异步IO来处理磁盘操作
IO merge

刷新临近页
杀心脏页时 会检测所在区所有的页 如果有脏页则一起刷新

文件
参数文件
mysql数据库的参数文件是以文本方式进行存储
参数  可以看做一个键值对  通过show variables命令查看数据库中的所有参数
参数分为两种
动态参数和静态参数
动态，即可以在运行过程中进行修改  通过set进行修改  global和session
静态，在整个实例的生命周期内都不得进行修改  类似只读

日志文件
记录影响mysql数据库的各类活动
包含：
错误日志  记录启动  运行  关闭过程  show variables like log_error来定位该文件
二进制日志
慢查询日志  定位存在问题的sql的语句
查询日志  记录了对mysql数据库的请求信息 默认文件名称：主机名.log

表
每个表都有个主键 若创建表时没有显示指定主键
innodb会按照以下原则选择主键：
1.判断表中是否存在非空的唯一索引 按照创建索引的顺序选择
2.自动创建一个6字节大小的指针

逻辑存储结构
所有数据被逻辑的放在一个空间中 即表空间
表空间由端 区 页组成 页在一些文档中也称为块
默认一个页的大小为16kb
常见的页类型
数据页
undo页
系统页
事务数据页
插入缓冲位图页
插入缓冲空闲列表页
未压缩的二进制大对象页
压缩的而兼职大对象页

行
一页大概存储16kb/2-200行 约7992行
分为compact和redundant两种
compact格式
格式
变长字段长度列表
null标志位
记录头信息
列1数据
列2数据
varchar长度限制65535

redundant是5.0前的格式
字段长度偏移列表 记录头信息 列1数据 列2数据 列3数据
compressed和dynamic行记录格式
1.0.x引入的新的格式

数据页结构
btree node
数据页的组成
file header 文件头
page header 页头
infimun superemum record
user record用户记录 行记录
free space空闲空间
page directory页目录
file trailer文件结尾信息
约束机制
外键约束
创建约束
建立表时就进行约束的定义
利用alter table命令来进行创建约束
保证数据的完整性
对错误数据的约束
外键约束

分区表
将一个表或索引分解为更小的部分






